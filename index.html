<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title></title>
</head>

<style type="text/css">
	#board{
		width: 366px;
		height: 366px;
		border: 3px solid black;
		background-color: lightblue;
		margin-left: auto;
		margin-right: auto;
		margin-top: 10%;
		display: flex;
		flex-wrap: wrap;
	}
	img {
		width:120px;
		height:120px;
		padding-left:1px;
		padding-right:1px;
	}

	.reset-btn {
		border: none;
		border-radius: 8px;
		color: white;
		width: 90px;
		height: 50px;
		text-align: center;
		text-decoration: none;
		display: inline-block;
		font-size: 16px;
		margin-top: 3%;
		margin-left: 58%;
		cursor: pointer;
		background-color: #4CAF50;

	}
</style>

<body>
	<div id="board"></div>
	<button class="reset-btn" id="reset" onclick="shuffleTiles()">shuffle</button>
</body>
	<script>
		const board = document.getElementById("board");
		let imgArr = [];
		let rows = 3;
		let cols = 3;
		let move = 0

		const completeBoard = new Map([
			["1-1", 1],
			["1-2", 2],
			["1-3", 3],
			["2-1", 4],
			["2-2", 5],
			["2-3", 6],
			["3-1", 7],
			["3-2", 8],
			["3-3", 9]
		]);

		//generate a random number between min and max
		function randomIntFromInterval(min, max) {
			return Math.floor(Math.random() * (max - min + 1) + min);
		}
		function getFileName(src) {
			let res = src.split("/").at(-1).split(".");
			return res.at(-2);
		}

		function swap(node1, node2) {
			//swap image
			let tmp = node1.src;
			node1.src = node2.src;
			node2.src = tmp;
			move += 1;
		}

		//store coordinates and image names to track tile positions
		function getCurrentBoard() {
			const nodeList = document.getElementsByTagName("img");
			let currentBoard = new Map([]);

			for(let i = 0; i < nodeList.length; i++) {
				let node = nodeList[i];
				let id = node.id;
				let imgName = getFileName(node.src);
				currentBoard.set(id, imgName);
			}
			return currentBoard;
		}

		//check whether puzzle has been solved
		function isBoardSolved(currentBoard, completeBoard) {
			let boardSolved = true;

			for (const coord of currentBoard.keys()) {
				if (currentBoard.get(coord) != completeBoard.get(coord)) {
					boardSolved = false;
					break;
				}
			}
			return boardSolved;
		}

		function moveTile() {
			let nodeId = this.id.split("-");
			let nodeRow = nodeId[0];
			let nodeCol = nodeId[1];

			//calculate adjacent tile coordinate id
			let topNodeId = (parseInt(nodeRow) - 1) + "-" + nodeCol;
			let btmNodeId = (parseInt(nodeRow) + 1) + "-" + nodeCol;
			let leftNodeId = nodeRow + "-" + (parseInt(nodeCol) - 1);
			let rightNodeId = nodeRow + "-" + (parseInt(nodeCol) + 1);

			let topNode = document.getElementById(topNodeId);
			let btmNode = document.getElementById(btmNodeId);
			let leftNode = document.getElementById(leftNodeId);
			let rightNode = document.getElementById(rightNodeId);
			
			if(topNode != null && getFileName(topNode.src) == "3") {
				swap(this, topNode);
			}
			else if(btmNode != null && getFileName(btmNode.src) == "3") {
				swap(this, btmNode);
			}
			else if(leftNode != null && getFileName(leftNode.src) == "3") {
				swap(this, leftNode);
			}
			else if(rightNode != null && getFileName(rightNode.src) == "3") {
				swap(this, rightNode);
			}
			else {
				console.log("empty tile not found");
			}

			let currentBoard = getCurrentBoard();
			var result  = isBoardSolved(currentBoard, completeBoard);

			if(result) {
				alert("Congrats you have solved the puzzle!");
			}
			else{
				console.log("not solved");
			}
		}

		//generate all random tiles
		function generateRandomTiles(n) {
			const uniqueTiles = new Set();
			while(uniqueTiles.size != n) {
				uniqueTiles.add(randomIntFromInterval(1,n));

			}
			imgArr = Array.from(uniqueTiles);
			// imgArr = ["1","2","3","4","5","6","7","8","9"];
		}

		function displayTiles() {
			var arrIdx = 0;
			for(let i = 1; i <= rows; i++) {
				for(let j = 1; j <= cols; j++) {
					var tile = document.createElement('img');
					//set row and column as coordinate in id with hyphen as seperator
					tile.id = i + "-" + j;
					tile.src = "img/" + imgArr[arrIdx] + ".jpg";
					tile.addEventListener('click', moveTile);
					board.appendChild(tile);
					arrIdx++;
				} //for
			} //for
		} //displayTiles

		function clearBoard() {
			const parent = document.getElementById("board");
			while (parent.firstChild) {
				parent.firstChild.remove();
			}
		}

		function shuffleTiles() {
			clearBoard();
			generateRandomTiles(9);
			displayTiles();
		}

		generateRandomTiles(9);
		displayTiles();


	</script>
</html>