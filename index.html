<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title></title>
</head>

<style type="text/css">
	.banner-container {
		width:450px;
		height:200px;
		margin-left: auto;
		margin-right: auto;
		display: flex;
	}
	#banner {
		width: 83%;
		margin-left: 8%;
	}
	
	#mushroom {
		margin-top: 32%;
		margin-left: -9%;
		z-index: -1;
	}

	#board {
		width: 366px;
		height: 366px;
		border: 3px solid black;
		background-color: lightblue;
		margin-top: 0.5%;
		margin-left: auto;
		margin-right: auto;
		display: flex;
		flex-wrap: wrap;
	}
	
	.timer-container {
		width:450px;
		margin-left: auto;
		margin-right: auto;
		font-family: Arial, Helvetica, sans-serif;
		font-size:20px;
	}
	
	#timer {
		margin-left: 43%;
	}

	.tile {
		width:120px;
		height:120px;
		padding-left:1px;
		padding-right:1px;
	}

	.btn-container {
		width: 378px;
		height: 200px;
		padding-top:3%;
		margin-left: auto;
		margin-right: auto;
		margin-top: -3%;
	}

	.btn {
		margin-top: 5%;
		border: none;
		border-radius: 8px;
		color: white;
		width: 90px;
		height: 50px;
		text-align: center;
		text-decoration: none;
		display: inline-block;
		font-size: 16px;
		cursor: pointer;
	}

	.level-btn {
		background-color: #007bff;
		border-color: #007bff;
		margin-right: 0.3%;
	}

	.reset-btn {
		background-color: #4CAF50;
		border-color: #4CAF50;
		margin-right: 0.3%;
	}

	.custom-btn {
		background-color: #fbbd04;
		border-color: #fbbd04;
	}

	.start-btn {
		background-color: #7426ff;
		border-color: #7426ff;
		margin-right: 0.3%;
	}

	button:disabled,
	button[disabled] {
		border: 1px solid #999999;
		background-color: #cccccc;
		color: #666666;
	}

</style>

<body>
	<!-- banner -->
	<div class="banner-container">
		<img src="img/banner.png" id="banner" />
		<img src ="img/animate_mushroom.gif" id="mushroom" />
	</div>

	<!-- timer -->
	<div class="timer-container">
		<span id="timer">00:00:10</span>
	</div>

	<div id="board"></div>
	<div class="btn-container">
		<!-- start button-->
		<button id="start" class="btn start-btn">start</button>

		<!-- diffculty drop-down menu -->
		<select id="modeDropdown" class="btn level-btn" onmousedown="this.value= '';" onchange="gameMode(this.value);">
			<option value="easy" selected>easy</option>
			<option value="medium">medium</option>
			<option value="hard">hard</option>
		</select>

		<!-- custom shuffle -->
		<select id="customDropdown" class="btn custom-btn">
			<option selected > custom </option>
			<option value="X" >X</option>
			<option value="Y">Y</option>
			<option value="Z">Z</option>
		</select>

		<!-- shuffle button -->
		<button class="btn reset-btn" id="reset" onclick="shuffleTiles()">shuffle</button>
		<!-- <input class="" type="text" placeholder="custom"> -->
	</div>
</body>
	<script>
		/* game mode */	
		const easy_mode = {
			rows: 3,
			cols: 3,
			maxRandomTile: 9,
			imgPath: "./img/bluesnail/",
			completeBoard: new Map ([
				["1-1", 1],
				["1-2", 2],
				["1-3", 3],
				["2-1", 4],
				["2-2", 5],
				["2-3", 6],
				["3-1", 7],
				["3-2", 8],
				["3-3", 9]
			]),
			emptyTile: "9",
			initSeq: ["1", "2", "3", "4", "5", "6", "7", "8", "9"],
			//css properties
			board_width: "366px",
			board_height: "366px",
			board_margin_top: "0.5%",
			tile_width: "120px",
			tile_height: "120px",
			padding_left: "1px",
			padding_right: "1px",
			customTilesX: ["1", undefined, "3", undefined, "5", undefined, "7", undefined, "9"],
			customTilesY: ["1",undefined, "3", undefined, "5", undefined, undefined, "8", undefined],
			customTilesZ: ["1", "2", "3", undefined, "5", undefined, "7", "8", "9"]
		}

		const medium_mode = {
			rows: 5,
			cols: 5,
			maxRandomTile: 25,
			imgPath: "./img/pinkbean/",
			completeBoard: new Map ([
				["1-1", 1],
				["1-2", 2],
				["1-3", 3],
				["1-4", 4],
				["1-5", 5],
				["2-1", 6],
				["2-2", 7],
				["2-3", 8],
				["2-4", 9],
				["2-5", 10],
				["3-1", 11],
				["3-2", 12],
				["3-3", 13],
				["3-4", 14],
				["3-5", 15],
				["4-1", 16],
				["4-2", 17],
				["4-3", 18],
				["4-4", 19],
				["4-5", 20],
				["5-1", 21],
				["5-2", 22],
				["5-3", 23],
				["5-4", 24],
				["5-5", 25],
			]),
			emptyTile: "25",
			initSeq: [
					  "1", "2", "3", "4", "5", "6", "7", "8", "9",
					  "10", "11", "12", "13", "14", "15", "16", 
					  "17", "18", "19", "20", "21", "22", "23",
					  "24", "25",
					  ],
			//css properties
			board_width: "610px",
			board_height: "610px",
			board_margin_top: "0.5%",
			tile_width: "120px",
			tile_height: "12px",
			padding_left: "1px",
			padding_right: "1px",
			customTilesX: [
						   "1", undefined, undefined, undefined, "5",
						   undefined, "7", undefined, "9", undefined,
						   undefined, undefined, "13", undefined, undefined,
						   undefined, "17", undefined, "19", undefined,
						   "21", undefined, undefined, undefined, "25"
						  ],

			customTilesY: [
						   "1", undefined, undefined, undefined, "5",
						   undefined, "7", undefined, "9", undefined,
						   undefined, undefined, "13", undefined, undefined,
						   undefined, undefined, "18", undefined, undefined,
						   undefined, undefined, "23", undefined, undefined
						   ],
			customTilesZ: [
						   "1", "2", "3", "4", "5",
						   undefined, undefined, undefined, "9", undefined,
						   undefined, undefined, "13", undefined, undefined,
						   undefined, "17", undefined, undefined, undefined,
						   "21", "22", "23", "24", "25"
						   ]
		}

		/* variable initialization */
		let board = document.getElementById("board"); //initial mode set to easy
		let imgArr = easy_mode.initSeq; //display initial sequence
		let rows = easy_mode.rows;
		let cols = easy_mode.cols;
		let maxRandomTile = easy_mode.maxRandomTile;
		let move = 0;
		let startBtn = document.getElementById("start");
		let countdown = null;
		let modeDropdown = document.getElementById("modeDropdown");
		let customDropdown = document.getElementById("customDropdown");
		let customValue = null;
		let mode = null; //store value from game difficulty dropdown menu
		let userTiming = null;

		//generate a random number between min and max
		function randomIntFromInterval(min, max) {
			return Math.floor(Math.random() * (max - min + 1) + min);
		}
		function getFileName(src) {
			let res = src.split("/").at(-1).split(".");
			return res.at(-2);
		}

		function swap(node1, node2) {
			//swap image
			let tmp = node1.src;
			node1.src = node2.src;
			node2.src = tmp;
			move += 1;
		}

		//store coordinates and image names to track tile positions
		function getCurrentBoard() {
			const nodeList = document.getElementsByClassName("tile");
			let currentBoard = new Map([]);

			for(let i = 0; i < nodeList.length; i++) {
				let node = nodeList[i];
				let id = node.id;
				let imgName = getFileName(node.src);
				currentBoard.set(id, imgName);
			}
			return currentBoard;
		}

		//check whether puzzle has been solved
		function isBoardSolved(currentBoard, completeBoard) {
			let boardSolved = true;

			for (const coord of currentBoard.keys()) {
				if (currentBoard.get(coord) != completeBoard.get(coord)) {
					boardSolved = false;
					break;
				}
			}
			return boardSolved;
		}

		function moveTile(selectedTile, mode) {
			let nodeId = selectedTile.id.split("-");
			let nodeRow = nodeId[0];
			let nodeCol = nodeId[1];

			//calculate adjacent tile coordinate id
			let topNodeId = (parseInt(nodeRow) - 1) + "-" + nodeCol;
			let btmNodeId = (parseInt(nodeRow) + 1) + "-" + nodeCol;
			let leftNodeId = nodeRow + "-" + (parseInt(nodeCol) - 1);
			let rightNodeId = nodeRow + "-" + (parseInt(nodeCol) + 1);

			let topNode = document.getElementById(topNodeId);
			let btmNode = document.getElementById(btmNodeId);
			let leftNode = document.getElementById(leftNodeId);
			let rightNode = document.getElementById(rightNodeId);
			
			function checkAndSwapEmptyTile(currentNode ,positionNode, emptyImgName) {
				if(positionNode != null && getFileName(positionNode.src) == emptyImgName) {
					swap(currentNode, positionNode);
				}
			}

			checkAndSwapEmptyTile(selectedTile, topNode, mode.emptyTile);
			checkAndSwapEmptyTile(selectedTile, btmNode, mode.emptyTile);
			checkAndSwapEmptyTile(selectedTile, leftNode, mode.emptyTile);
			checkAndSwapEmptyTile(selectedTile, rightNode, mode.emptyTile);

			let currentBoard = getCurrentBoard();
			let result  = isBoardSolved(currentBoard, mode.completeBoard);

			if(result) {
				alert("Congrats you have solved the puzzle!");
			}
			else{
				console.log("not solved");
			}
		} //moveTile

		//generate all random tiles
		function generateRandomTiles(n, customTiles) {
			let uniqueTiles = customTiles;
			
			//user did not select value in custom dropdown
			if(uniqueTiles === undefined) {
				uniqueTiles = new Array();
	
				while(uniqueTiles.length != n) {
					let randNum = randomIntFromInterval(1,n);
					if (!uniqueTiles.includes(randNum)) {
						uniqueTiles.push(randNum);
					}
				} //while				

			} //if
			else {
				//fill sparse array with random value
				while(uniqueTiles.includes(undefined)) {
					let randNum = randomIntFromInterval(1,n).toString();

					//checks generated random number value existed in array
					//before filling sparse array index with random number
					if(uniqueTiles.includes(randNum) == false) {
						for(let i = 0; i < uniqueTiles.length; i++) {
							//fill undefined type with unique random number
							if(uniqueTiles[i] === undefined) {
								uniqueTiles[i] = randNum;
								break;
							}
						} //for
					} //if
				 } //while
			} //else
			imgArr = uniqueTiles;
		}

		function displayTiles(mode) {
			let arrIdx = 0;
			for(let i = 1; i <= rows; i++) {
				for(let j = 1; j <= cols; j++) {
					let tile = document.createElement('img');
					//set row and column as coordinate in id with hyphen as seperator
					tile.id = i + "-" + j;
					tile.className = "tile";
					tile.src = mode.imgPath + imgArr[arrIdx] + ".jpg";
					tile.addEventListener('click', function() {
						moveTile(tile, mode);
					});
					board.appendChild(tile);
					arrIdx++;
				} //for
			} //for
		} //displayTiles

		function clearBoard() {
			const parent = document.getElementById("board");
			while (parent.firstChild) {
				parent.firstChild.remove();
			}
		}

		function shuffleTiles(maxRandomTile, mode) {
			clearBoard();

			if(customValue == "X") {
				generateRandomTiles(maxRandomTile, mode.customTilesX);
			}
			else if(customValue == "Y") {
				generateRandomTiles(maxRandomTile, mode.customTilesY);
			}
			else if(customValue == "Z") {
				generateRandomTiles(maxRandomTile, mode.customTilesZ);
			}
			else {
				generateRandomTiles(maxRandomTile);
			}

			displayTiles(mode);
		}

		//countdown for user to memorise complete image
		function startCountdown(callback) {
			let timer = document.getElementById("timer").innerText.split(":")[2];

			//perform casting to retrieve seconds in integer
			countdownSec = parseInt(timer);	

			countdown = setInterval(function() {
				//displays countdown on page
				countdownSec--; 
				document.getElementById("timer").innerText = "00:00:0" + countdownSec;

				if(countdownSec == 0) {
					clearInterval(countdown);
					callback();
				} //if
			},1000); //setInterval
			
		} //startCountdown

		//time user it takes to complete sliding puzzle
		function startTimer() {
			//reset countdown displayed
			document.getElementById("timer").innerText = "00:00:00";

			let second = 0, minute = 0, hour = 0;
			let dis_sec = 0, dis_min = 0, dis_hr = 0;			
			userTiming = setInterval(updateTime, 1000);

			function updateTime() {
				second += 1;
				
				if(second == 60) {
					minute += 1;
					second = 0; 
				}

				if(minute == 60) {
					hour += 1;
					minute = 0;
				}

				//reset to 00:00:00 and stop timer
				if(hour == 24) {
					document.getElementById("timer").innerText = "00:00:00";
					clearInterval(userTiming);
				}

				function resolveDoubleDigit(value) {
					//return padded zero
					if(value < 10) {
						return "0" + value;
					}
					//otherwise return original value
					return value;
				}

				dis_sec = resolveDoubleDigit(second);
				dis_min = resolveDoubleDigit(minute);
				dis_hr = resolveDoubleDigit(hour);

				document.getElementById("timer").innerText = dis_hr + ":" + dis_min + ":" + dis_sec;
			} //updateTime
		} //startTimer
		
		function resetTimer(myTimer) {
			clearInterval(myTimer);
			document.getElementById("timer").innerText = "00:00:10";
		}

		function main() {
			//display initial complete tiles
			displayTiles(easy_mode);

			//start count down and when it is finish, run callback function
			startCountdown(function() {
					//get selected custom dropdown
					customValue = customDropdown.options[customDropdown.selectedIndex].value;
					shuffleTiles(easy_mode.maxRandomTile, easy_mode);
					startTimer();
					
					//disable start button once game has started
					startBtn.disabled = true;
			}); //startCountdown
			
			//start game immediately when user does not wait for countdown to complete
			startBtn.addEventListener("click", function(){
				//get selected custom dropdown
				customValue = customDropdown.options[customDropdown.selectedIndex].value;
				
				//get selected difficulty level
				mode = modeDropdown.options[modeDropdown.selectedIndex].value;
				
				//reset timer
				resetTimer(countdown);
				resetTimer(userTiming);
				
				startTimer();
				clearBoard();
				
				if(mode == "easy") {
					shuffleTiles(easy_mode.maxRandomTile, easy_mode);
				}

				if(mode == "medium") {
					shuffleTiles(medium_mode.maxRandomTile, medium_mode);
					
				}

				//disable start button once game has started
				startBtn.disabled = true;
			}); //startBtn

		} //main
		
		// trigger by game difficulty dropdown menu
		function gameMode(mode) {
			//get selected custom dropdown
			customValue = customDropdown.options[customDropdown.selectedIndex].value;
				
			//reset timer
			resetTimer(countdown);
			resetTimer(userTiming);

			//clear tiles from previous board setting
			clearBoard();

			//re-enable start button
			document.getElementById('start').disabled = false;

			if (mode == "easy") {
				//change board css property
				board.style.width = easy_mode.board_width;
				board.style.height = easy_mode.board_height;
				rows = easy_mode.rows;
				cols = easy_mode.cols;
				maxRandomTile = easy_mode.maxRandomTile;
				imgArr = easy_mode.initSeq;

				displayTiles(easy_mode);
				startCountdown(function() {
					startTimer();
					shuffleTiles(easy_mode.maxRandomTile, easy_mode);
				});
			}

			if (mode == "medium") {
				//change board css property
				board.style.width = medium_mode.board_width;
				board.style.height = medium_mode.board_height;
				rows = medium_mode.rows;
				cols = medium_mode.cols;
				maxRandomTile = medium_mode.maxRandomTile;
				imgArr = medium_mode.initSeq;
				
				displayTiles(medium_mode);
				startCountdown(function() {
					startTimer();
					shuffleTiles(medium_mode.maxRandomTile, medium_mode);
				});
			}
		} //gameMode

		//main function runs on default easy mode
		main();


	</script>
</html>